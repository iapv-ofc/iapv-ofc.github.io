<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Google Search Console Verification -->
    <meta name="google-site-verification" content="_vbBwR2qhq2Km07SbSLoWRYjwh2v9AOg4arKykouJVE" />

    <!-- SEO Básico -->
    <title>IAPV - Igreja Apostólica Palavra e Verdade | Uma Igreja em Célula</title>
    <meta name="description" content="Bem-vindo à IAPV - Igreja Apostólica Palavra e Verdade. Somos uma igreja em célula focada em comunhão, adoração e discipulado. Encontre uma unidade em Cajuru, Ribeirão Preto, Santa Rosa e região.">
    <meta name="keywords" content="Igreja, IAPV, Palavra e Verdade, Célula, Culto, Deus, Jesus, Cajuru, Ribeirão Preto, Santa Rosa de Viterbo, Santo André">
    <meta name="author" content="IAPV Comunicação">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Facebook / WhatsApp -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://site-iapv-9fdd1.web.app/">
    <meta property="og:title" content="IAPV - Igreja Apostólica Palavra e Verdade">
    <meta property="og:description" content="Uma igreja em célula. Venha nos visitar e conhecer nossa família!">
    <meta property="og:image" content="https://i.ibb.co/kg5D1brF/IMG-7186.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://site-iapv-9fdd1.web.app/">
    <meta property="twitter:title" content="IAPV - Igreja Apostólica Palavra e Verdade">
    <meta property="twitter:description" content="Uma igreja em célula. Venha nos visitar e conhecer nossa família!">
    <meta property="twitter:image" content="https://i.ibb.co/kg5D1brF/IMG-7186.jpg">

    <link rel="icon" href="images/simbolo-iapv.svg?v=1" type="image/svg+xml">
    
    <!-- Fonte Montserrat (Google Fonts) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. Swiper.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <!-- 3. Lucide Icons -->
    <script src="https://cdn.jsdelivr.net/npm/lucide-react@0.395.0/dist/lucide.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                    },
                    colors: {
                        'accent': '#005DCC',
                    }
                },
            },
        };
    </script>

    <!-- Estilos personalizados -->
    <style>
        .swiper-button-next,
        .swiper-button-prev {
            color: #fff;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            transition: all 0.2s ease-in-out;
        }
        .swiper-button-next:after,
        .swiper-button-prev:after {
            font-size: 20px;
            font-weight: 900;
        }
        .swiper-button-next:hover,
        .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }

        .lucide-icon {
            display: inline-block;
            width: 1em;
            height: 1em;
            stroke-width: 2;
            stroke: currentColor;
            fill: none;
        }

        .custom-select-filter {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding: 12px 48px 12px 24px; 
            font-size: 16px;
            font-weight: 600;
            color: #e0e0e0;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            backdrop-filter: blur(10px);
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            width: 100%;
            background-image: none;
        }
        .custom-select-filter:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        .custom-select-filter:focus {
            outline: none;
            ring: 2px;
            ring-color: #005DCC;
        }
        .custom-select-filter option {
            background-color: #1f2937;
            color: #e0e0e0;
        }

        .swiper-pagination-bullet {
            background-color: #aaa;
            opacity: 0.7;
        }
        .swiper-pagination-bullet-active {
            background-color: #005DCC;
            opacity: 1;
        }

        .photo-gallery-card-frame {
            width: 100%; 
            aspect-ratio: 4 / 5; 
            background: none;
            border: none;
            border-radius: 30px;
            box-shadow: 0px 4px 10px 0px rgba(0, 0, 0, 0.2);
            padding: 0; 
            @apply dark:shadow-black/30;
        }

        .photo-gallery-card-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 30px;
        }

        .btn-album-animado {
            --btn-bg-1: hsla(211, 100%, 70% / 1);
            --btn-bg-2: hsla(211, 100%, 40% / 1);
            --btn-bg-color: hsla(0, 0%, 100% / 1);
            --radii: 0.5em;

            cursor: pointer;
            padding: 0.9em 1.4em;
            min-width: 120px;
            min-height: 44px;
            font-size: 1.125rem;
            font-weight: 700;
            transition: 0.8s;
            background-size: 280% auto;
            background-image: linear-gradient(325deg, var(--btn-bg-2) 0%, var(--btn-bg-1) 55%, var(--btn-bg-2) 90%);
            border: none;
            border-radius: var(--radii);
            color: var(--btn-bg-color);
            box-shadow: 0px 0px 20px rgba(0, 93, 204, 0.5), 0px 5px 5px -1px rgba(0, 93, 204, 0.25), inset 4px 4px 8px rgba(0, 123, 255, 0.5), inset -4px -4px 8px rgba(0, 68, 153, 0.35);
        }

        .btn-album-animado:hover {
            background-position: right top;
        }

        .btn-album-animado:is(:focus, :focus-visible, :active) {
            outline: none;
            box-shadow: 0 0 0 3px var(--btn-bg-color), 0 0 0 6px var(--btn-bg-2);
        }

        /* Efeito para os Logos dos Projetos */
        .project-logo {
            filter: grayscale(100%);
            opacity: 0.6;
            transition: all 0.3s ease;
        }
        .project-logo:hover {
            filter: grayscale(0%);
            opacity: 1;
            transform: scale(1.05);
        }

        @media (prefers-reduced-motion: reduce) {
            .btn-album-animado {
                transition: linear;
            }
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-900 antialiased">

    <!-- ===== SEÇÃO 1: CAPA E FILTRO GLOBAL ===== -->
    <header class="h-screen min-h-[600px] w-full flex flex-col items-center justify-center relative bg-cover bg-center bg-no-repeat" style="background-image: url('https://i.ibb.co/kg5D1brF/IMG-7186.jpg');">
        <div class="absolute inset-0 bg-black/60 z-0"></div>

        <div class="relative z-10 flex flex-col items-center text-center px-4">
            <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-white shadow-lg">
                Bem vindo(a) á Igreja Palavra e Verdade
            </h1>
            <p class="mt-4 text-base sm:text-lg md:text-xl text-gray-200 font-light shadow-md">
                Uma igreja em célula
            </p>

            <div class="mt-12">
                <label for="unit-select-filter" class="text-lg text-white mb-4 block">Selecione sua unidade:</label>
                <div class="relative w-full max-w-sm mx-auto px-4 sm:px-0">
                    <select id="unit-select-filter" class="custom-select-filter">
                        <option value="">Carregando unidades...</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-300">
                        <svg class="fill-current h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                    </div>
                </div>
                <p id="location-status" class="text-center text-xs text-gray-400 mt-2 h-4"></p>
            </div>
        </div>
    </header>

    <main class="w-full">

        <!-- ===== SEÇÃO 2: MISSÃO, VISÃO, VALORES ===== -->
        <section id="sobre" class="py-20 px-4 max-w-6xl mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                <!-- Missão -->
                <div class="group relative bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-2">
                    <div class="absolute inset-0 bg-gradient-to-br from-accent/10 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <div class="relative flex flex-col items-center">
                        <div class="w-20 h-20 bg-accent rounded-2xl flex items-center justify-center mb-6 transform group-hover:rotate-6 transition-transform duration-300 shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon w-10 h-10 text-white"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg>
                        </div>
                        <h3 class="text-2xl font-bold mb-4 text-gray-900 dark:text-white flex items-center gap-2">Missão</h3>
                        <p class="text-gray-600 dark:text-gray-300 leading-relaxed">Levar a palavra de Deus a todos, vivendo o amor de Cristo e servindo ao próximo com alegria e dedicação.</p>
                    </div>
                </div>
                <!-- Visão -->
                <div class="group relative bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-2">
                    <div class="absolute inset-0 bg-gradient-to-br from-accent/10 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <div class="relative flex flex-col items-center">
                        <div class="w-20 h-20 bg-accent rounded-2xl flex items-center justify-center mb-6 transform group-hover:rotate-6 transition-transform duration-300 shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon w-10 h-10 text-white"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                        </div>
                        <h3 class="text-2xl font-bold mb-4 text-gray-900 dark:text-white flex items-center gap-2">Visão</h3>
                        <p class="text-gray-600 dark:text-gray-300 leading-relaxed">Ser uma igreja relevante e transformadora, que impacta a sociedade através de células que multiplicam discípulos.</p>
                    </div>
                </div>
                <!-- Valores -->
                <div class="group relative bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-2">
                    <div class="absolute inset-0 bg-gradient-to-br from-accent/10 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <div class="relative flex flex-col items-center">
                        <div class="w-20 h-20 bg-accent rounded-2xl flex items-center justify-center mb-6 transform group-hover:rotate-6 transition-transform duration-300 shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon w-10 h-10 text-white"><path d="M6 3h12l4 6-10 13L2 9Z"/><path d="M11 3 8 9l4 13 4-13-3-6"/><path d="M2 9h20"/></svg>
                        </div>
                        <h3 class="text-2xl font-bold mb-4 text-gray-900 dark:text-white flex items-center gap-2">Valores</h3>
                        <p class="text-gray-600 dark:text-gray-300 leading-relaxed">Comunhão, Adoração, Serviço, Evangelismo e Discipulado. Pilares que sustentam nossa fé e nossas ações.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <hr class="border-gray-300 dark:border-gray-700/50 max-w-6xl mx-auto" />

        <!-- ===== SEÇÃO 3: EVENTOS ===== -->
        <section id="eventos" class="py-20 px-4 w-full max-w-7xl mx-auto">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-4">Eventos</h2>
            <p class="text-lg text-gray-600 dark:text-gray-400 text-center mb-10">
                Fique por dentro da nossa agenda para a unidade <span id="eventos-unidade" class="font-bold text-accent">Carregando...</span>
            </p>

            <!-- Caixa de Pesquisa -->
            <div class="mb-8 max-w-lg mx-auto">
                <input type="text" id="event-search-box" placeholder="Pesquisar evento..." class="w-full px-4 py-3 rounded-lg bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-accent">
            </div>

            <!-- Carrossel (Swiper.js) -->
            <div class="relative">
                <div id="eventos-slider" class="swiper-container overflow-hidden">
                    <div class="swiper-wrapper" id="eventos-wrapper">
                        <!-- Os slides serão injetados aqui pelo JavaScript -->
                    </div>
                </div>
                <!-- Botões de Navegação -->
                <div class="swiper-button-prev -left-4 md:-left-12"></div>
                <div class="swiper-button-next -right-4 md:-right-12"></div>
            </div>

            <!-- Mensagem de "Nenhum resultado" -->
            <p id="eventos-nenhum-resultado" class="text-center text-gray-500 dark:text-gray-400 mt-8 text-lg hidden">
                Nenhum evento encontrado.
            </p>
        </section>

        <hr class="border-gray-300 dark:border-gray-700/50 max-w-6xl mx-auto" />

       <!-- ===== SEÇÃO EXTRA: PROJETOS ===== -->
        <section id="projetos" class="py-16 bg-white dark:bg-gray-900">
            <div class="max-w-7xl mx-auto px-4">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-10 text-gray-800 dark:text-white">Nossos Projetos</h2>
                
                <div class="relative">
                    <div id="projetos-slider" class="swiper-container overflow-hidden">
                        <div class="swiper-wrapper items-center select-none">
                            <!-- Logo 1 -->
                            <div class="swiper-slide flex justify-center p-4">
                                <img src="https://i.ibb.co/ns6F89BY/Kids.png" alt="Projeto Kids" class="project-logo max-h-20 w-auto object-contain">
                            </div>
                            <!-- Logo 2 -->
                            <div class="swiper-slide flex justify-center p-4">
                                <img src="https://i.ibb.co/rR6MXrDn/Acamp.png" alt="Ação Social" class="project-logo max-h-20 w-auto object-contain">
                            </div>
                            <!-- Logo 3 -->
                            <div class="swiper-slide flex justify-center p-4">
                                <img src="https://i.ibb.co/QjkzvbS8/Remidas.png" alt="Ministério de Louvor" class="project-logo max-h-20 w-auto object-contain">
                            </div>
                            <!-- Logo 4 -->
                            <div class="swiper-slide flex justify-center p-4">
                                <img src="https://i.ibb.co/pBQFNnZk/CNX.png" alt="Ministério de Mulheres" class="project-logo max-h-20 w-auto object-contain">
                            </div>
                            <!-- Logo 5 -->
                            <div class="swiper-slide flex justify-center p-4">
                                <img src="https://i.ibb.co/TBLxprxz/Eden.png" alt="Ministério de Homens" class="project-logo max-h-20 w-auto object-contain">
                            </div>
                            <!-- Logo 6 -->
                            <div class="swiper-slide flex justify-center p-4">
                                <img src="https://placehold.co/200x100/transparent/555?text=Teens" alt="Ministério Teens" class="project-logo max-h-20 w-auto object-contain">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <hr class="border-gray-300 dark:border-gray-700/50 max-w-6xl mx-auto" />

        <!-- ===== SEÇÃO 4: FOTOS ===== -->
        <section id="fotos" class="py-20 px-4 w-full max-w-7xl mx-auto">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-10">Galeria de Fotos</h2>
            
            <div class="relative">
                <div id="fotos-slider" class="swiper-container overflow-hidden">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide p-2"><div class="photo-gallery-card-frame"><img src="https://i.ibb.co/qMGGTywr/IMG-8079.jpg" alt="Foto 1"></div></div>
                        <div class="swiper-slide p-2"><div class="photo-gallery-card-frame"><img src="https://i.ibb.co/gLgBVJ8W/IMG-1839.jpg" alt="Foto 2"></div></div>
                        <div class="swiper-slide p-2"><div class="photo-gallery-card-frame"><img src="https://i.ibb.co/BKCn1r03/IMG-4173.jpg" alt="Foto 3"></div></div>
                        <div class="swiper-slide p-2"><div class="photo-gallery-card-frame"><img src="https://placehold.co/400x500/5E35B1/EDE7F6?text=FotoCajuru1" alt="Foto 4"></div></div>
                        <div class="swiper-slide p-2"><div class="photo-gallery-card-frame"><img src="https://i.ibb.co/1GR4CFN0/Firefly-20251118174131.png" alt="Foto 5"></div></div>
                        <div class="swiper-slide p-2"><div class="photo-gallery-card-frame"><img src="https://i.ibb.co/hFxtcRX5/IMG-2089.jpg" alt="Foto 6"></div></div>
                        <div class="swiper-slide p-2"><div class="photo-gallery-card-frame"><img src="https://i.ibb.co/gZd68K20/IMG-7168.jpg" alt="Foto 7"></div></div>
                        <div class="swiper-slide p-2"><div class="photo-gallery-card-frame"><img src="https://placehold.co/400x500/1f2937/9ca3af?text=FotoCajuru2" alt="Foto 8"></div></div>
                    </div>
                </div>
                <div class="swiper-button-prev -left-4 md:-left-12"></div>
                <div class="swiper-button-next -right-4 md:-right-12"></div>
            </div>

            <!-- Botão do Álbum -->
            <div class="text-center mt-10">
                <a id="fotos-album-link" href="#" target="_blank" class="inline-block bg-accent text-white font-bold py-3 px-8 rounded-full text-lg transition-all duration-200 hover:bg-accent/90 focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2">
                    Ver álbum completo de <span id="fotos-unidade-nome">Carregando...</span>
                </a>
            </div>
        </section>

        <!-- ===== SEÇÃO 5: CONTATO E MAPA ===== -->
        <footer id="contato" class="py-20 px-4 bg-gray-100 dark:bg-gray-900/50">
            <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-12">
                <!-- Coluna Esquerda: Mapa -->
                <div class="h-96 md:h-full min-h-[400px] rounded-lg overflow-hidden">
                    <iframe id="mapa-iframe" src="" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
                <!-- Coluna Direita: Informações -->
                <div class="flex flex-col justify-center gap-10">
                    <div class="flex items-start gap-4">
                        <div class="pt-1"><i data-lucide="map-pin" class="lucide-icon w-6 h-6 text-accent"></i></div>
                        <div><h4 class="text-xl font-bold mb-1">Endereço</h4><p id="contato-endereco" class="text-lg text-gray-700 dark:text-gray-300">Carregando...</p></div>
                    </div>
                    <div class="flex items-start gap-4">
                        <div class="pt-1"><i data-lucide="clock" class="lucide-icon w-6 h-6 text-accent"></i></div>
                        <div><h4 class="text-xl font-bold mb-1">Horário dos Cultos</h4><p id="contato-horarios" class="text-lg text-gray-700 dark:text-gray-300 whitespace-pre-line">Carregando...</p></div>
                    </div>
                    <div class="flex items-start gap-4">
                        <div class="pt-1"><i data-lucide="heart-handshake" class="lucide-icon w-6 h-6 text-accent"></i></div>
                        <div>
                            <h4 class="text-xl font-bold mb-1">Siga-nos</h4>
                            <div class="flex gap-5 mt-2">
                                <a id="social-instagram" href="#" target="_blank" class="text-gray-500 dark:text-gray-400 hover:text-accent transition-colors">
                                    <svg aria-hidden="true" focusable="false" class="w-7 h-7" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                                </a>
                                <a id="social-youtube" href="#" target="_blank" class="text-gray-500 dark:text-gray-400 hover:text-accent transition-colors">
                                    <svg aria-hidden="true" focusable="false" class="w-7 h-7" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </main>

    <!-- ===== JAVASCRIPT PRINCIPAL ===== -->
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
        import { getFirestore, collection, doc, getDoc, getDocs, onSnapshot, query, where, orderBy, setLogLevel } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB1-NkxI4ZxBqsHIK6dzq3c365HLl_DZFs",
            authDomain: "site-iapv-9fdd1.firebaseapp.com",
            projectId: "site-iapv-9fdd1",
            storageBucket: "site-iapv-9fdd1.firebasestorage.app",
            messagingSenderId: "353341906524",
            appId: "1:353341906524:web:f6ec38996a2b336f9d1099",
            measurementId: "G-9JPBKP1R12"
        };

        const unitCoordinates = {
            'cajuru': { lat: -21.274679, lng: -47.313766 },
            'ribeiraopreto': { lat: -21.160206, lng: -47.840043 },
            'santarosa': { lat: -21.492530, lng: -47.378818 },
            'santoandre': { lat: -23.622757, lng: -46.541219 }
        };

        let db;
        let swiperEventos;
        let currentUnitId = null;
        let allUnitsData = {};

        try {
            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
            db = getFirestore(app);
            console.log("Firebase inicializado com sucesso!");
        } catch (error) {
            console.error("Erro ao inicializar o Firebase: ", error);
            document.getElementById('eventos-unidade').textContent = "Erro de conexão";
            document.getElementById('eventos-wrapper').innerHTML = '<p class="text-center text-red-500">Não foi possível conectar ao banco de dados.</p>';
        }

        document.addEventListener('DOMContentLoaded', () => {
            if(db) initializeAppLogic();
        });

        async function initializeAppLogic() {
            if (typeof lucide !== 'undefined') lucide.createIcons();
            initializeSwipers();
            await loadUnitsDropdown();
            attemptGeolocation();

            const unitSelect = document.getElementById('unit-select-filter');
            unitSelect.addEventListener('change', (event) => {
                const unitId = event.target.value;
                if(unitId) {
                    updatePageContent(unitId);
                    document.getElementById('location-status').textContent = "";
                }
            });

            document.getElementById('event-search-box').addEventListener('input', filterEventsBySearch);
        }

        function initializeSwipers() {
            swiperEventos = new Swiper('#eventos-slider', {
                slidesPerView: 1,
                spaceBetween: 20,
                navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
                breakpoints: {
                    640: { slidesPerView: 2, spaceBetween: 20 },
                    1024: { slidesPerView: 3, spaceBetween: 30 },
                    1280: { slidesPerView: 4, spaceBetween: 30 }
                }
            });

            // Inicializa o Slider de Projetos
            new Swiper('#projetos-slider', {
                slidesPerView: 2,
                spaceBetween: 30,
                loop: true,
                autoplay: {
                    delay: 2000,
                    disableOnInteraction: false,
                },
                breakpoints: {
                    480: { slidesPerView: 3, spaceBetween: 30 },
                    768: { slidesPerView: 4, spaceBetween: 40 },
                    1024: { slidesPerView: 5, spaceBetween: 50 }
                }
            });

            new Swiper('#fotos-slider', {
                loop: true,
                autoplay: { delay: 3000, disableOnInteraction: false },
                spaceBetween: 30,
                slidesPerView: 1,
                breakpoints: {
                    768: { slidesPerView: 2, spaceBetween: 30 },
                    1024: { slidesPerView: 3, spaceBetween: 30 }
                },
                navigation: { nextEl: '#fotos .swiper-button-next', prevEl: '#fotos .swiper-button-prev' },
            });
        }

        function attemptGeolocation() {
            const statusText = document.getElementById('location-status');
            if ("geolocation" in navigator) {
                statusText.textContent = "Localizando unidade mais próxima...";
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const closestUnitId = findNearestUnit(position.coords.latitude, position.coords.longitude);
                        if (closestUnitId && closestUnitId !== currentUnitId) {
                            updatePageContent(closestUnitId);
                            document.getElementById('unit-select-filter').value = closestUnitId;
                            statusText.textContent = `Localizado: ${allUnitsData[closestUnitId].name}`;
                        } else {
                            statusText.textContent = "";
                        }
                    },
                    (error) => {
                        console.warn("Geolocalização negada ou falhou:", error.message);
                        statusText.textContent = ""; 
                    }
                );
            }
        }

        function findNearestUnit(userLat, userLng) {
            let minDistance = Infinity;
            let closestUnit = null;
            for (const [unitId, coords] of Object.entries(unitCoordinates)) {
                const distance = getDistanceFromLatLonInKm(userLat, userLng, coords.lat, coords.lng);
                if (distance < minDistance) { minDistance = distance; closestUnit = unitId; }
            }
            return closestUnit;
        }

        function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
            const R = 6371; 
            const dLat = deg2rad(lat2 - lat1);
            const dLon = deg2rad(lon2 - lon1);
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }
        function deg2rad(deg) { return deg * (Math.PI / 180); }

        async function loadUnitsDropdown() {
            const unitsCollection = collection(db, "units");
            const unitSelect = document.getElementById('unit-select-filter');
            try {
                const querySnapshot = await getDocs(query(unitsCollection));
                if (querySnapshot.empty) {
                    unitSelect.innerHTML = '<option value="">Nenhuma unidade cadastrada</option>';
                    return;
                }
                let optionsHtml = '';
                let defaultUnitId = 'cajuru'; 
                let foundDefault = false;
                querySnapshot.forEach((doc) => {
                    if (doc.id === 'global') return; 
                    const unit = doc.data();
                    unit.id = doc.id; 
                    allUnitsData[doc.id] = unit; 
                    if (doc.id === defaultUnitId) foundDefault = true;
                    optionsHtml += `<option value="${doc.id}">${unit.name.toUpperCase()}</option>`;
                });
                unitSelect.innerHTML = optionsHtml;
                if (!foundDefault && Object.keys(allUnitsData).length > 0) defaultUnitId = Object.keys(allUnitsData)[0];
                if (defaultUnitId) {
                    currentUnitId = defaultUnitId;
                    unitSelect.value = defaultUnitId;
                    updatePageContent(defaultUnitId);
                }
            } catch (error) {
                console.error("Erro ao carregar unidades: ", error);
                unitSelect.innerHTML = '<option value="">Erro ao carregar</option>';
            }
        }

        function updatePageContent(unitId) {
            currentUnitId = unitId;
            const unitData = allUnitsData[unitId];
            if (!unitData) return;

            document.getElementById('unit-select-filter').value = unitId;
            document.getElementById('eventos-unidade').textContent = unitData.name;
            loadEventsForUnit(unitId, unitData.name);
            document.getElementById('fotos-unidade-nome').textContent = unitData.name;
            document.getElementById('fotos-album-link').href = unitData.albumUrl || '#';
            document.getElementById('mapa-iframe').src = unitData.mapUrl || '';
            document.getElementById('contato-endereco').textContent = unitData.address || 'Endereço não informado';
            document.getElementById('contato-horarios').textContent = unitData.times || 'Horários não informados';
            document.getElementById('social-instagram').href = unitData.socials?.instagram || '#';
            document.getElementById('social-youtube').href = unitData.socials?.youtube || '#';
            document.getElementById('event-search-box').value = '';
        }

        async function loadEventsForUnit(unitId, unitName) {
            const wrapper = document.getElementById('eventos-wrapper');
            wrapper.innerHTML = '<p class="text-center text-gray-500">Carregando eventos...</p>';
            const noResultsMsg = document.getElementById('eventos-nenhum-resultado');
            noResultsMsg.classList.add('hidden');

            const todayString = new Date().toISOString().split('T')[0];

            // Busca eventos que ainda não terminaram (ou que são recorrentes com data de fim longínqua)
            const unitEventsCollection = collection(db, `units/${unitId}/events`);
            const qUnit = query(unitEventsCollection, where("endDate", ">=", todayString));
            const globalEventsCollection = collection(db, `units/global/events`);
            const qGlobal = query(globalEventsCollection, where("endDate", ">=", todayString));

            try {
                const [unitSnapshot, globalSnapshot] = await Promise.all([
                    getDocs(qUnit),
                    getDocs(qGlobal)
                ]);

                let allEvents = [];
                const pushEvent = (doc) => {
                    let data = doc.data();
                    
                    // --- LÓGICA PARA EVENTOS RECORRENTES ---
                    if (data.isRecurring && data.dayOfWeek !== undefined) {
                        const today = new Date();
                        const resultDate = new Date();
                        
                        // Calcula quantos dias faltam até o próximo dia da semana desejado
                        // Fórmula: (DiaAlvo - DiaHoje + 7) % 7
                        let daysUntil = (data.dayOfWeek - today.getDay() + 7) % 7;
                        
                        // Se cair hoje (0), verifica se o horário já passou
                        if (daysUntil === 0) {
                            const [h, m] = (data.time || "00:00").split(':');
                            const eventTime = new Date();
                            eventTime.setHours(parseInt(h), parseInt(m), 0);
                            if (today > eventTime) {
                                daysUntil = 7; // Já passou, joga para a próxima semana
                            }
                        }
                        
                        resultDate.setDate(today.getDate() + daysUntil);
                        
                        // Define o horário correto para a ordenação funcionar
                        const [h, m] = (data.time || "00:00").split(':');
                        resultDate.setHours(parseInt(h), parseInt(m), 0);
                        
                        // Atualiza os dados de exibição (sem salvar no banco)
                        const day = String(resultDate.getDate()).padStart(2, '0');
                        const month = String(resultDate.getMonth() + 1).padStart(2, '0');
                        
                        data.displayNextDate = `${day}/${month}`; // Ex: 24/11
                        data.date = `Todo(a) ${getDayName(data.dayOfWeek)}`; // Texto principal
                        data.startDate = resultDate.toISOString(); // Data ISO para o sort()
                        data.isRecurringInstance = true;
                    }
                    allEvents.push(data);
                };

                unitSnapshot.forEach(pushEvent);
                globalSnapshot.forEach(pushEvent);

                // Remove duplicatas (por segurança) e ordena
                const uniqueEvents = Array.from(new Set(allEvents.map(e => JSON.stringify(e)))).map(s => JSON.parse(s));
                uniqueEvents.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
                
                allUnitsData[unitId].events = uniqueEvents;
                updateEventSlider(uniqueEvents, unitName);

            } catch (error) {
                console.error("Erro ao buscar eventos: ", error);
                wrapper.innerHTML = `<p class="text-center text-red-500">Erro ao carregar eventos.</p>`;
            }
        }

        function getDayName(dayIndex) {
            const days = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
            return days[dayIndex] || '';
        }

        function createEventCard(event, unitName) {
            const location = event.location || unitName;
            const calendarLink = createGoogleCalendarLink(event, location);
            
            // Exibe data calculada se for recorrente
            const dateDisplay = event.isRecurringInstance 
                ? `<span class="block text-xs font-bold text-accent uppercase tracking-wider mb-1">Próximo: ${event.displayNextDate}</span>${event.date}` 
                : event.date;

            const calendarIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon inline-block text-accent"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></svg>`;
            const mapPinIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-icon inline-block text-accent"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>`;

            return `
                <div class="swiper-slide h-auto p-4">
                    <a href="${calendarLink}" target="_blank" rel="noopener noreferrer" 
                       class="group relative block w-full h-72 min-h-[280px] bg-white rounded-[30px] shadow-lg hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 overflow-hidden border border-gray-200"
                       style="box-shadow: 0 10px 15px -3px var(--tw-shadow-color, rgba(0, 93, 204, 0.1));">
                        <div class="relative z-[1] flex flex-col justify-center items-center h-full p-5 text-center">
                            <div>
                                <h4 class="text-xl font-bold text-gray-800 mb-3 leading-tight">${event.title}</h4>
                                <div class="text-sm text-gray-600 mb-3 flex flex-col items-center justify-center gap-1">
                                    <div class="flex items-center font-medium">
                                        ${calendarIcon}
                                        <span class="ml-1.5">${event.time}</span>
                                    </div>
                                    <span class="text-gray-500">${dateDisplay}</span>
                                </div>
                                <div class="text-sm text-gray-600 flex items-center justify-center">
                                    ${mapPinIcon}
                                    <span class="ml-1.5 truncate max-w-[200px]">${location}</span>
                                </div>
                            </div>
                            <span class="mt-6 inline-block bg-accent text-white font-bold py-2 px-4 rounded-lg text-xs transition-transform duration-200 group-hover:scale-105 shadow-md">
                                Adicionar à Agenda
                            </span>
                        </div>
                    </a>
                </div>
            `;
        }
        
        function updateEventSlider(eventsToShow, unitName) {
            const wrapper = document.getElementById('eventos-wrapper');
            const noResultsMsg = document.getElementById('eventos-nenhum-resultado');
            if (!eventsToShow || eventsToShow.length === 0) {
                wrapper.innerHTML = '';
                noResultsMsg.classList.remove('hidden');
                noResultsMsg.textContent = "Nenhum evento futuro encontrado para esta unidade.";
            } else {
                wrapper.innerHTML = eventsToShow.map(event => createEventCard(event, unitName)).join('');
                noResultsMsg.classList.add('hidden');
            }
            if (swiperEventos) {
                swiperEventos.update();
                swiperEventos.slideTo(0);
            }
        }
        
        function filterEventsBySearch() {
            const searchTerm = document.getElementById('event-search-box').value.toLowerCase();
            if (!currentUnitId || !allUnitsData[currentUnitId] || !allUnitsData[currentUnitId].events) return;
            const allFutureEvents = allUnitsData[currentUnitId].events;
            const unitName = allUnitsData[currentUnitId].name;
            const noResultsMsg = document.getElementById('eventos-nenhum-resultado');
            if (!searchTerm) {
                updateEventSlider(allFutureEvents, unitName);
                noResultsMsg.textContent = "Nenhum evento futuro encontrado para esta unidade.";
                return;
            }
            const filteredEvents = allFutureEvents.filter(event => event.title.toLowerCase().includes(searchTerm));
            updateEventSlider(filteredEvents, unitName);
            if (filteredEvents.length === 0) noResultsMsg.textContent = "Nenhum evento encontrado com esse nome.";
        }

        function createGoogleCalendarLink(event, location) {
            const baseUrl = 'https://www.google.com/calendar/render?action=TEMPLATE';
            const formatISODate = (isoStr) => isoStr.replace(/-|:|\.\d+/g, '');
            let dates = '';
            if (event.startDate && event.endDate) {
                // Para eventos recorrentes, gera link apenas para a PRÓXIMA ocorrência calculada
                // Para garantir compatibilidade, criamos uma 'endDate' fictícia de 1h se não existir
                let startStr = event.startDate;
                let endStr = event.endDate;
                
                // Se for recorrente, a 'endDate' do banco é 2099. Precisamos calcular a duração real do culto (ex: 2h)
                if (event.isRecurringInstance) {
                    const startObj = new Date(event.startDate);
                    const endObj = new Date(startObj);
                    endObj.setHours(endObj.getHours() + 2); // Assume 2h de duração padrão
                    endStr = endObj.toISOString();
                }

                try {
                     dates = `${formatISODate(startStr)}/${formatISODate(endStr)}`;
                } catch(e) {
                    console.warn("Erro ao formatar data calendário", e);
                }
            }
            const text = encodeURIComponent(event.title);
            const details = encodeURIComponent(`Participe conosco do evento "${event.title}" na ${location}.`);
            const loc = encodeURIComponent(location);
            return `${baseUrl}&text=${text}&dates=${dates}&details=${details}&location=${loc}`;
        }
    </script>
</body>
</html>
